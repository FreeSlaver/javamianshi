---
layout: page
breadcrumb: true
title: Redis线上生产环境问题总结
category: redis
categoryStr: redis
tags: [redis]
keywords: 
description:
---

首先以你自己对Redis的理解来思考下会在哪些环节出问题？
首先是使用上的，最低端的，
比如使用keys命令将线上Redis给搞堵塞了，然后其他Redis请求去阻塞，服务直接拖垮挂掉了。
解决，使用Scan命令，先去拿到想要数据后本地过滤。

Redis内存爆了，先看看是哪些key占用了大量的内存，是否设置超时时间，然后看redis的内存淘汰策略和过期机制是否设置的合理。
再看是否发生了缓存偏移，大量的数据缓存到一个redis实例上面。

还一个是Redis同步时候出现问题，从发送同步命令，但是数据量太大，导致超时，又发送同步命令，然后就阻塞在哪里了，不停的重试。

Redis集群的问题，刚开始中集电商使用Redis的时候，是使用的客户端的一致性hash来将数据hash到多个redis实例上的。
后面就出问题了。

句柄数用完

连接超时，
Redis丢数据问题，Redis分布式锁出问题，箱格状态经常有异常。

另外一个是Redis和数据库双写同步性问题。

服务攻击，连接攻击，

Redis占用容量暴增
1.看看是否被流量攻击了
2.发现项目中使用了Set结构，而Set里面数据量太大了。

作为开发，我们必须熟悉自己所在公司的redis生产集群的部署架构。
主从架构？
集群架构？
用了哪种集群方案？
有没有做高可用保证？
有没有开启持久化机制确保可以进行数据恢复？
线上redis给几个G的内存？
设置了哪些参数？
压测后你们redis集群承载多少QPS？
redis cluster
10台机器，5台机器部署了redis主节点，另外5台机器部署了redis的从节点。
每个主节点挂了一个从节点，5个节点对外提供读写服务，每个节点的读写高峰QPS可能可以达到每秒5万，5台机器最多是25万个QPS。
机器配置
32G内存+8核CPU+1T磁盘，但是分配给redis进程的是10g内存，一般线上生产环境，redis的内存尽量不要超过10g，超过10g可能会有问题。

5台机器对外提供读写，一共有50g内存。

因为每个主实例都挂了一个从实例，所以是高可用的，任何一个主实例宕机，都会自动故障迁移，redis从实例会自动变成主实例继续提供读写服务
你往内存里写的是什么数据？每条数据的大小是多少？
商品数据，每条数据是10kb。100条数据是1mb，10万条数据是1g。常驻内存的是200万条商品数据，占用内存是20g，仅仅不到总内存的50%。
目前高峰期3500QPS。
